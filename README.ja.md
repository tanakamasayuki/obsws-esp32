# OBSWS-ESP32

ESP32系デバイスからOBS Studioを公式OBS WebSocketプロトコル経由で制御できるArduino向けライブラリです。組み込み機器から可能な限り多くのOBS操作を扱いつつ、メイカーやプロダクト開発者が使いやすいAPIを目指します。

## ステータス

> ⚠️ プレアルファ段階。基盤整備中のため仕様やAPIは変更される可能性があります。

## 主な機能（計画中）

- ✅ Wi-Fi越しのOBS WebSocket 5.x認証ハンドシェイク
- ✅ FreeRTOS上での軽量クライアントコア（ESP32向け最適化）
- ✅ イベント購読とディスパッチを柔軟に行うコールバックルーティング
- ✅ シーン・ソース・トランジション管理ヘルパー
- ✅ 配信・録画・リプレイバッファ制御
- ✅ 再接続とハートビート維持の設定可能なルーチン
- ✅ マイコン環境に収まるミニマルなJSON処理
- ✅ 低遅延用途向けのコマンドバッチングとプリセットマクロ

## アーキテクチャ概要

1. **トランスポート層**: `WiFiClientSecure`（または代替ネットワークアダプタ）を基盤にしたTCP/WebSocketスタック。TLSは任意で切り替え可能。
2. **プロトコル層**: OBS WebSocket 5.xのフレーミング、メッセージ署名、リクエスト/レスポンス追跡を実装。
3. **イベント層**: イベントペイロードをユーザー定義ハンドラーへルーティングし、フィルタリング機能を提供。
4. **ファサードAPI**: よく使うOBS操作をArduinoスタイルの高レベルメソッドで提供しつつ、高度な用途向けに低レベルパススルーも用意。

## ハードウェア & ソフトウェア要件

- ESP32（シングル/デュアルコア問わず）; 推奨RAM 520 KB以上。
- Arduinoフレームワーク（ESP-IDF対応は計画対象外）。
- OBS Studio 29以上 + OBS WebSocket 5.x有効化。
- OBSホストとESP32の双方が到達できる安定したWi-Fiネットワーク。

## はじめかた（予定フロー）

1. **依存関係の準備**: Arduino IDEまたはPlatformIOでESP32ボードパッケージを導入。
2. **ライブラリ導入**: Arduinoライブラリマネージャからインストール（公式配布）。開発版を利用する場合はGitサブモジュールやZip読み込みを使用。
3. **OBS設定**: WebSocketサーバーを有効化し、認証設定とホスト/ポート/パスワードを控える。
4. **ファームウェア記述**:
   ```cpp
   #include <ObsWsEsp32.h>

   ObsWsClient client;

   void setup() {
     // ...existing setup code...
     client.begin({
       .host = "192.168.0.50",
       .port = 4455,
       .password = "supersecret",
       .onEvent = handleObsEvent
     });
   }

   void loop() {
     client.poll();
   }

   void handleObsEvent(const ObsEvent& event) {
     // ...existing handler code...
   }
   ```
5. **書き込み & モニタ**: ファームを書き込み、シリアルモニタでハンドシェイクとコマンド応答を確認。

> ライブラリ例に含まれるコメントは一貫性確保のため英語表記とします。

## ロードマップハイライト

- [ ] コア接続マネージャーと再接続戦略の確定。
- [ ] シーン/ソース/トランジション/出力系など主要OBSエンドポイントのリクエストラッパ実装。
- [ ] ライブ運用向けマクロ記録・再生ユーティリティの提供。
- [ ] サンプルスケッチ（ストリームデッキ、タリーランプ、シーンローテータ等）の追加。
- [ ] PlatformIOサンプルプロジェクトとCIビルドの提供。
- [ ] OBS WebSocketリファレンスサーバーを用いた統合テストの整備。

## コントリビューション

- コードコメントとコミットメッセージは英語で統一してください。
- ESP32ツールチェーンでビルド可能なC++17モダン機能を優先。
- 事前整形や静的解析（内容は今後定義）を実行してからPRを作成。
- Issuesでは対象OBS機能と使用ハード構成を明記してください。

自動化ポリシーやコラボレーションワークフローは `AGENTS.md` を参照してください。

## 運営とコミュニケーション

- **主なチャンネル**: GitHub Issues & Discussions。
- **リリースサイクル**: OBS Studioのメジャー更新に合わせたマイルストンを目標。
- **メンテナーチーム**: 未定。役割分担は今後 `AGENTS.md` に記載します。

## ライセンス

MIT License（`LICENSE` 参照）で公開し、コントリビューションも同ライセンスに準拠します。

## 謝辞

- OBS ProjectおよびOBS WebSocketメンテナチーム。
- ESP32コミュニティのコントリビューターとArduinoコアメンテナ。
